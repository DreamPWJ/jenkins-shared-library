#!groovy
@Library('jenkins-shared-library@dev') _

/**
 * @author æ½˜ç»´å‰
 * @description æ ¸å¿ƒPipelineä»£ç  é’ˆå¯¹å°ç¨‹åºé¡¹ç›®CI/CDçš„è„šæœ¬
 * æ³¨æ„ æœ¬æ–‡ä»¶åœ¨Gitä½ç½®å’Œåç§°ä¸èƒ½éšä¾¿æ”¹åŠ¨ é…ç½®åœ¨jenkinsé‡Œ
 */
// Pipelineéœ€è¦å®‰è£…çš„æ’ä»¶

// æ ¹æ®ä¸åŒç¯å¢ƒé¡¹ç›®é…ç½®ä¸åŒå‚æ•°
def map = [:]

// ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°
map.put('build_num_keep', 2)

// é»˜è®¤è¦æ„å»ºçš„Gitåˆ†æ”¯
map.put('default_git_branch', 'master')

// æ˜¯å¦Pipelineå†…è„šæœ¬é’‰é’‰é€šçŸ¥  æ€»å¼€å…³
map.put('is_ding_notice', false)
// æ˜¯å¦åªé€šçŸ¥å‘å¸ƒå˜æ›´è®°å½•
map.put('is_only_notice_change_log', false)
// æ˜¯å¦åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒæˆåŠŸåè‡ªåŠ¨ç»™Gitä»“åº“æ‰“Tagç‰ˆæœ¬å’Œç”Ÿæˆå˜æ›´è®°å½•
map.put('is_git_tag', false)

// é¡¹ç›®æ ‡ç­¾æˆ–é¡¹ç›®ç®€ç§°
map.put('project_tag', ' ')

// jenkinsåˆ†å¸ƒå¼æ„å»ºèŠ‚ç‚¹labelåç§°  é¢„é…ç½®åœ¨jenkinsèŠ‚ç‚¹ç®¡ç†å†…
map.put('jenkins_node', 'master')

// æ„å»ºç¯å¢ƒå˜é‡
map.put('nodejs', 'Node14')

// ç›¸å…³ä¿¡ä»»æ ‡è¯†
map.put('ci_git_credentials_id', '45392b97-5c21-4451-b323-bbf104f70e51')
map.put('git_credentials_id', '45392b97-5c21-4451-b323-bbf104f70e51')
map.put('ding_talk_credentials_id', 'ba0ebec7-73ad-4a26-af8b-d15c470b1328')
// OSSå¯¹è±¡å­˜å‚¨è®¿é—®å‡­æ®é…ç½® Jenkinsç³»ç»Ÿç®¡ç†çš„Manage Credentialsï¼Œç±»å‹é€‰æ‹©ä¸ºâ€œSecret fileâ€é…ç½®
map.put('oss_credentials_id', ' ')

// è°ƒç”¨æ ¸å¿ƒé€šç”¨Pipeline
miniSharedLibrary(map)


// ---------------------------------------------------------------------------------------------------------------------

// https://github.com/DreamPWJ/jenkins-shared-library.git  Jenkinsfile.mini

/*
test-wx-mini
æµ‹è¯•å¾®ä¿¡å°ç¨‹åºæµæ°´çº¿
JSON_PARAMS:
{
  "PROJECT_TYPE" : "1",
  "REPO_URL" : "https://github.com/DreamPWJ/smart-health.git",
  "DEFAULT_GIT_BRANCH" : "dev",
  "IS_MINI_NATIVE_NEED_NPM" : true,
  "PROJECT_CHINESE_NAME" : "æµ‹è¯•"
}

test-taro-mini
æµ‹è¯•Taroè·¨å¹³å°å°ç¨‹åºæµæ°´çº¿ ğŸš´ğŸ»â€â™€ï¸
JSON_PARAMS:
{
  "PROJECT_TYPE" : "2",
  "REPO_URL" : "https://github.com/DreamPWJ/health-mini.git",
  "DEFAULT_GIT_BRANCH" : "dev",
  "NPM_RUN_PARAMS" : "test:weapp",
  "NPM_BUILD_DIRECTORY" : "dist",
  "PROJECT_CHINESE_NAME" : "Taroæµ‹è¯•"
}

test-monorepo-mini
æµ‹è¯•Monorepoå°ç¨‹åºæµæ°´çº¿
JSON_PARAMS:
{
  "PROJECT_TYPE" : "1",
  "REPO_URL" : "https://github.com/DreamPWJ/panweiji/panweiji-mini.git",
  "DEFAULT_GIT_BRANCH" : "dev",
  "PROJECT_CHINESE_NAME" : "Monorepoæµ‹è¯•",
  "IS_MONO_REPO" : true,
  "IS_MINI_NATIVE_NEED_NPM" : true,
  "PROJECT_NAME" : "property-sales"
}
*/
